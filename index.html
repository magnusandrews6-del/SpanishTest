<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta charset="UTF-8">
<title>Spanish Conjugation Trainer</title>
<style>
  body {
    font-family: Arial;
    padding: 10px;
    max-width: 600px;
    margin: auto;
    -webkit-text-size-adjust: 100%;
    color: #FFFFFF; 
    background-color: #151B45; 
  }

  h1 {
    text-align: center;
  }

  #input-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
  }

  input {
    padding: 10px;
    font-size: 18px;
    width: 100%;
    box-sizing: border-box;
  }

  button {
    padding: 10px 20px;
    font-size: 18px;
    margin-top: 10px;
  }

  #feedback {
    margin-top: 10px;
    font-weight: bold;
  }

  #score {
    font-weight: bold;
    white-space: nowrap;
    margin: 0;
  }
</style>
</head>
<body>

<h1>Spanish Conjugation Trainer</h1>
<p id="prompt"></p>

<div id="input-container">
  <input id="answer" type="text" autocomplete="off">
  <p id="score">Score: 0/0</p>
</div>

<button type="button" onclick="speakSpanish(currentQuestion.correctAnswer)">ðŸ”Š Listen</button>
<button onclick="checkAnswer()">Submit</button>
<p id="feedback"></p>

<script>
// --- Data ---
const verbs = [
  { infinitive: "hablar", type: "ar", english: "speak" },
  { infinitive: "comer", type: "er", english: "eat" },
  { infinitive: "vivir", type: "ir", english: "live" },
  { infinitive: "ir", type: "ir", english: "go" },
  { infinitive: "ser", type: "ir", english: "be" },
  { infinitive: "ver", type: "er", english: "see" },
  { infinitive: "tener", type: "er", english: "have" },
  { infinitive: "hacer", type: "er", english: "do/make" },
  { infinitive: "venir", type: "ir", english: "come" },
  { infinitive: "decir", type: "ir", english: "say/tell" }
];

const tenses = {
  present: {
    endings: { ar:["o","as","a","amos","Ã¡is","an"], er:["o","es","e","emos","Ã©is","en"], ir:["o","es","e","imos","Ã­s","en"] },
    irregulars: {
      ir:["voy","vas","va","vamos","vais","van"],
      ser:["soy","eres","es","somos","sois","son"],
      ver:["veo","ves","ve","vemos","veis","ven"],
      tener:["tengo","tienes","tiene","tenemos","tenÃ©is","tienen"],
      hacer:["hago","haces","hace","hacemos","hacÃ©is","hacen"],
      venir:["vengo","vienes","viene","venimos","venÃ­s","vienen"],
      decir:["digo","dices","dice","decimos","decÃ­s","dicen"]
    }
  },
  imperfect: {
    endings: { ar:["aba","abas","aba","Ã¡bamos","abais","aban"], er:["Ã­a","Ã­as","Ã­a","Ã­amos","Ã­ais","Ã­an"], ir:["Ã­a","Ã­as","Ã­a","Ã­amos","Ã­ais","Ã­an"] },
    irregulars: {
      ir:["iba","ibas","iba","Ã­bamos","ibais","iban"],
      ser:["era","eras","era","Ã©ramos","erais","eran"],
      ver:["veÃ­a","veÃ­as","veÃ­a","veÃ­amos","veÃ­ais","veÃ­an"]
    }
  },
  preterite: {
    endings: { ar:["Ã©","aste","Ã³","amos","asteis","aron"], er:["Ã­","iste","iÃ³","imos","isteis","ieron"], ir:["Ã­","iste","iÃ³","imos","isteis","ieron"] },
    irregulars: {
      ir:["fui","fuiste","fue","fuimos","fuisteis","fueron"],
      ser:["fui","fuiste","fue","fuimos","fuisteis","fueron"],
      ver:["vi","viste","vio","vimos","visteis","vieron"],
      tener:["tuve","tuviste","tuvo","tuvimos","tuvisteis","tuvieron"],
      hacer:["hice","hiciste","hizo","hicimos","hicisteis","hicieron"],
      venir:["vine","viniste","vino","vinimos","vinisteis","vinieron"],
      decir:["dije","dijiste","dijo","dijimos","dijisteis","dijeron"]
    }
  }
};

const pronouns = [
  { spanish:"yo", english:"I" },
  { spanish:"tÃº", english:"You (sing.)" },
  { spanish:"Ã©l/ella", english:"He/She" },
  { spanish:"nosotros", english:"We" },
  { spanish:"vosotros", english:"You (pl.)" },
  { spanish:"ellos", english:"They" }
];

const englishTenses = {
  hablar: { present:["speak","speak","speaks","speak","speak","speak"], imperfect:["was speaking","were speaking","was speaking","were speaking","were speaking","were speaking"], preterite:["spoke","spoke","spoke","spoke","spoke","spoke"] },
  comer: { present:["eat","eat","eats","eat","eat","eat"], imperfect:["was eating","were eating","was eating","were eating","were eating","were eating"], preterite:["ate","ate","ate","ate","ate","ate"] },
  vivir: { present:["live","live","lives","live","live","live"], imperfect:["was living","were living","was living","were living","were living","were living"], preterite:["lived","lived","lived","lived","lived","lived"] },
  ir: { present:["go","go","goes","go","go","go"], imperfect:["was going","were going","was going","were going","were going","were going"], preterite:["went","went","went","went","went","went"] },
  ser: { present:["am","are","is","are","are","are"], imperfect:["was","were","was","were","were","were"], preterite:["was","were","was","were","were","were"] },
  ver: { present:["see","see","sees","see","see","see"], imperfect:["was seeing","were seeing","was seeing","were seeing","were seeing","were seeing"], preterite:["saw","saw","saw","saw","saw","saw"] },
  tener: { present:["have","have","has","have","have","have"], imperfect:["was having","were having","was having","were having","were having","were having"], preterite:["had","had","had","had","had","had"] },
  hacer: { present:["do","do","does","do","do","do"], imperfect:["was doing","were doing","was doing","were doing","were doing","were doing"], preterite:["did","did","did","did","did","did"] },
  venir: { present:["come","come","comes","come","come","come"], imperfect:["was coming","were coming","was coming","were coming","were coming","were coming"], preterite:["came","came","came","came","came","came"] },
  decir: { present:["say","say","says","say","say","say"], imperfect:["was saying","were saying","was saying","were saying","were saying","were saying"], preterite:["said","said","said","said","said","said"] }
};

// --- Utilities ---
function randomItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function removeAccents(str){ return str.normalize("NFD").replace(/[\u0300-\u036f]/g,""); }

// --- Conjugation ---
function conjugate(verb, tenseName, personIndex){
  const tense = tenses[tenseName];
  if(tense.irregulars[verb.infinitive]) return tense.irregulars[verb.infinitive][personIndex];
  const stem = verb.infinitive.slice(0,-2);
  return stem + tense.endings[verb.type][personIndex];
}

// --- Speech synthesis ---
function speakSpanish(text){
  if('speechSynthesis' in window){
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'es-ES';

    // Get all available voices
    let voices = window.speechSynthesis.getVoices();

    // If voices are not yet loaded, wait a short time and try again
    if(voices.length === 0){
      window.speechSynthesis.onvoiceschanged = () => speakSpanish(text);
      return;
    }

    // Try to pick a natural-sounding Spanish voice
    // Prioritize iOS voices like "Monica", "Jorge" if available
    let preferredVoices = ['Monica','Jorge','Diego','Maria'];
    let spanishVoice = voices.find(v => preferredVoices.includes(v.name));
    
    // If no preferred voice, fallback to any Spanish voice
    if(!spanishVoice){
      spanishVoice = voices.find(v => v.lang.startsWith('es'));
    }

    if(spanishVoice) utterance.voice = spanishVoice;

    window.speechSynthesis.speak(utterance);
  }
}

// Ensure voices are loaded on iOS at page load
window.addEventListener('load', () => { window.speechSynthesis.getVoices(); });


// --- Session variables ---
let currentQuestion = null;
let sessionCorrect = 0;
let sessionCount = 0;
const sessionTotal = 20;

// --- Update score display ---
function updateScore(){
  document.getElementById("score").innerText = `Score: ${sessionCorrect}/${sessionCount}`;
}

// --- Generate question ---
function newQuestion(){
  if(sessionCount >= sessionTotal){
    document.getElementById("prompt").innerText = "Session finished";
    document.getElementById("answer").style.display = "none";
    document.querySelectorAll("button").forEach(b => b.style.display = "none");
    document.getElementById("feedback").innerText += ` Final score: ${sessionCorrect}/${sessionTotal}`;
    return;
  }

  const verb = randomItem(verbs);
  const tenseName = randomItem(Object.keys(tenses));
  const personIndex = Math.floor(Math.random()*pronouns.length);
  const pronoun = pronouns[personIndex];

  const english = pronoun.english + " " + englishTenses[verb.infinitive][tenseName][personIndex];
  const correctAnswer = conjugate(verb, tenseName, personIndex);

  currentQuestion = { verb, tenseName, personIndex, correctAnswer };
  document.getElementById("prompt").innerText = english;
  document.getElementById("answer").value = "";
  document.getElementById("feedback").innerText = "";
  updateScore();
}

// --- Check answer ---
function checkAnswer(){
  const input = document.getElementById("answer").value.trim().toLowerCase();
  const tokens = input.split(/\s+/);
  const userVerb = tokens[tokens.length-1];
  const normalizedUserVerb = removeAccents(userVerb);
  const normalizedCorrect = removeAccents(currentQuestion.correctAnswer);

  sessionCount++;
  if(normalizedUserVerb === normalizedCorrect){
    sessionCorrect++;
    document.getElementById("feedback").innerText = `Correct!`;
  } else {
    document.getElementById("feedback").innerText = `Incorrect. Correct: ${currentQuestion.correctAnswer}`;
  }

  // Speak the correct Spanish answer
  speakSpanish(currentQuestion.correctAnswer);

  updateScore();
  setTimeout(newQuestion, 1500);
}

// --- Enter key support ---
document.getElementById("answer").addEventListener("keydown", function(event){
  if(event.key === "Enter") checkAnswer();
});

// --- Start ---
newQuestion();
</script>

</body>
</html>


